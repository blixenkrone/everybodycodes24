package main

import (
	"bytes"
	"fmt"
	"testing"

	"github.com/davecgh/go-spew/spew"
	"github.com/stretchr/testify/assert"
)

var potionM = map[string]int{
	"A": 0,
	"B": 1,
	"C": 3,
	"D": 5,
}

func solve(in string) int {
	var totalPotions int
	in += "@"
	k := 0

	for i := 0; i < len(in)-1; i += 3 {
		k++
		if i == len(in)-1 || in[i] == '@' {
			break
		}
		if i+3 > len(in) {
			break
		}

		// battle
		enemies := calcNumEnemies(in[i : i+3])

		for _, m := range enemies {
			if v, ok := potionM[string(m)]; ok {
				numPotions := v + (len(enemies) - 1)
				fmt.Println("num potions needed for battle", k, numPotions)
				totalPotions += numPotions
			}
		}
	}
	return totalPotions
}

func calcNumEnemies(segment string) []byte {
	// Trim 'x' from segment to isolate enemies
	enemyChars := bytes.TrimFunc([]byte(segment), func(r rune) bool {
		return r == 'x'
	})
	return enemyChars
}

// func calcNumEnemies(str string) []byte {
// 	if len(str) > 3 {
// 		panic("SHIT")
// 	}
// 	arr := []byte{str[0], str[1], str[2]}
// 	arr = bytes.TrimFunc(arr, func(r rune) bool {
// 		return r == 'x'
// 	})
// 	num := bytes.TrimSpace(arr)
// 	// num := strings.Split(str, "x")

// 	fmt.Println("enemies", string(num))
// 	return num
// 	// pair := str[0] != 'x' && str[1] != 'x' && str[2] != 'x'
// 	// fmt.Println("pair? ", str, pair)
// 	// return pair
// }

func TestSolve(t *testing.T) {
	// t.Run("Small", func(t *testing.T) {
	// 	in := "ABBAC"
	// 	want := 5

	// 	got := solve(in)
	// 	assert.Equal(t, got, want)

	// })
	t.Run("Small p3", func(t *testing.T) {
		in := "xBxAAABCDxCC"
		want := 30

		got := solve(in)
		assert.Equal(t, got, want)

	})
	// t.Run("Small pt 2", func(t *testing.T) {
	// 	in := "AxBCDDCAxD"
	// 	want := 28

	// 	got := solve(in)
	// 	assert.Equal(t, want, got)

	// })
	t.Run("Actual", func(t *testing.T) {
		// t.Skip()
		in := "DxCDCDDCADAxDCxBADCADBDAxDDDACxADxDABADBDCDDBDCxABxDABADCBCxACAxDDDDCCDBACxAxCBxxDADBDDxDDxADCAAxxAABxBxxACBAACCCCxCDDBxxADxACCABDxBABCDABxBCCCBDxxxBxCBxDBCxBBCDBADABCAxCCxDACBBxxBACBxAAxCBDBxDBxABCCxACxDACBCBxACDxBADBADDDABDBDCxAxAxBACACxAxDAACCxxAxBBDDxxCBABACBDDACCxDBCDxADBDABACxDCCAADxCDBBDxxBADCCACBAACDxxBDCAABDxCDABDxABABCABBBCDDAxACxABxCCADCAACDADDCBDBCACCxDxBAxCAxxDCBBAACCBCCxAACDCDBDCDxACDDCxxxDBCAxDDCDDBCxADACDABxDBCxCDBxDCxCDDCCBxCxxBDACxDxxAxCBBBDBxxxABBBCxDDAxAxBCCxBBDDADDxBCxCBBDDCAAAxxDAABCCDDBDxCDABADDADCBBAADBBDDxDBDBAxBACCCBBABDCxCxxBBxDBBxADAxCDDBDCBxDBCCBBBxAxAxADCxCCxDBxDDBxACCBxAxxDxDDABDxBxDBDBxDxDxBDDAxDCCBBABACCDABCxCxADBxDAAxBxCBADAxBADADBADBxDABCCBABxxAACDDADBACxBADxBxAxDBxBxxBCDxCCCCBDDDxxBAAxADCDAADCBADCBxCxxCACCCCxABDDBADDCxDxCADDxxAAAACAxADxACBDCDDBBBBBBBCxBxCDAACxBDDBABDxDADDDCDxDBDCDxxBxxBDxAxADBAAAADACxBAAxADADxDAxCDDDBBxCDDxCAAxDACCxCBCADCxDCBCxCCxAxBxCBDCDCxDAxBDCxABCAAACBDDACAACCBxCxBxxCxxAAABAxxxDBDAACADADCxxxDBxxDCCABAxBDACDCDCADDDAxDBAxCAADxCDxADxxAxBAxBxCBCBDCxBCxxBACxAAxxBCBxBxxBxxxxCCBxCxDABABDADDDCCAAxxDxCxBxBAxDAACADxABxAxAxDCABACCxDDBACACBxxADxCDDDAxBABCDCxBAxAxxxDCAACCCCAxACBAxxBBAAxxxxBDBCDCBxxDBBDDDABDBAACxDDCBDCDxAxDxDBAABBCADABCADDCBAxxDxDxCxDBABBBBCxCAABCCDBxBxxBBABABCBCCBBxxADxABCDDDxDCCBBxCCCCCCBBxCAxDADBxCAAAADBAxCCBBCCCxCxxxABxxDBxBAACDDxBDDAxDDABxDDDBDDxxxAxCABBADDxDABAAADDxDBBBBDCBxADAAADDDDBxxCBxBBBBCxBBxBxxBBCBAAxAADAACCADCAAxDAAxCDDDCxDCxBxDABCxDxDxxAAACABAxDCxBxxCDDCACACBABxDDxCDCxBDBBBBxCDBBCDCADDxDxxCCxDDADxBxBCBCDDBABDBCBABCBABCCCxADxAABxBCDBxBDBxBxDDBBBxxDDDBDACxBBxCxAxBCAAxxxxDBCACDCxDDCxBAADDCDBCCCDBBxDCDBxACAADDBCCAxBCDCDAxACxDCCDDDBAAxxxADCxCBBCxDABABxDBADDABxBxDDBDAxBADDAAxACDDDBBBBACxCBCBDCCBxCDCACBDxxABxxCCBBCBADxxCCCDABCAABDDBCAxBDDCCCDADxABDADCABBxBADACACDDxxDCCDCAAAxBBBxBBBBBBDxxBDDxxxDBxDBDCDDBxxxADxCDCDBDCDxADxCABCBADDxxDACDDxDBCBxxxxDxxADADABCAABDABABDCDACCAACxCBDACDABBxAACABCxDCxCABxDxxxDDDDDAxAxADxABBCCCBxDBxACBxDADAxDDCxDBxCDAxDADCABCDBxADxAAADBBBxxxCxDDDBDBCCAxADCBACxDDxCCDDBDCBCDBDxxCBDCBxDCCCACBCCxAAxABxAxBABCBBBDDBCDBBDAADBDxxABDBxCCCDCCCAAxxBDBxxBBBBCDADCxDDADCADBxCCBACBAADAxACBBxxADxAACAADBDAACDCCxxBDDCABxCAxBBCAxDACxxCBCxADCAADADABBxDxCCCBADDCxxCCCBDBABCDABBxBACCCxAxBDDBxxBDCDCCAAAxCxxABBBADADCBCDAACBADBDCDCADACBDCDxABDADDDAxxACxxAABCBxCxxDCBxBxBDCDxCDDACDBCDxBABAxDAxBAAxACBDBCxCCxAABxACCxDDCDDBDCABCBxAxBBBxCCAAAAxAxCDCCxAAxxBDBDAxCDBBCBCACxAAxBACDBCBCDxDBxCxAADADBAxCBCBCACBDCADCxBDBADBDxAxBABBDDxDCDCxDDDCxDDAADCxxDCxDDxBDABACBBBCCABBxACxABxxDxCDBDxCCBCADBAxBAxADBDDADCDABADCDCCABxABDABDDACDxxDBxxDADCADDBxCCCDCCCBCDxDBCDBxCACDxCBxBCABCCDDDxDxCBBCAAACBBCxxDDACCDACBxCCCBBAABCBDDCABCDxCxAxBDBAxBCAxxCBxABDCxCBxxCDCDCBCABDDDDCDABDBDDABAxCxBCxCDxCDDBxBCDBDxDDBCCABBACxxDBDxBDCCDBBxABBDDxCCCxBCDBBBCxBDBxADxAxCxBDAxxBBCxADABBxCxAxxDCAABBxxCDxDxxACAxAxBDxCCCCBDCDDCDxxDBDADDDxCxBBBCCACABxDDBCDxxAxDACCACCCDDCDxDDCDxDAACACCxAxBCxAxDDAACACDDADxACCBCADDDADDCBCxBCxDCDBCxCxCCBACCABACDDxBxxAxAxBCDxBxBADBDBxxCCBxBADxBBBCxAAxBBBxAxABDxCACDxDBAACDDDAxBBDDDCxCBCBxBADBBDDDxDDCCBBxDABCDBDxCDCDDADCCABxDCACACCADCAAxDABBBAxACxABDCBDBAAADDCBDxBxABBBCDAACDBxBCACCxxAADBADACxAxCACADDAxABxBBABBCDBADCDxDCDBAAAxAABDDDCxCAxDBxBxxABADxDDxBxAAACBDDxCAAxADCxCAADADxBBDxDxABBCxDxxCDBCCAAxxAAxxxxBAxxDBBADDBAAxxxCBBACBxBxCDBDBBACxBBAADxDDABxAxDACCBABxBBDxDAxAxCDACCxCxCBxxDxADAAAAADCACBDxDxxADCACDDBAxxxDDDBABBBCxxxBDCCADCDCCDAAxDDDBDxDxDCADAxDBBBDDxCxDxACDADxABADxBBCDBxACBxCCxxDDBCBDCxDDADxCDBABAABBCCBDABBCDCDBDCABCABADxCCDBxDADxxxCCxADxABxABADCBAAxDDxxDBBDBDCACxxDBADABCCCADxBCAxCACCDBCBAACxCABAxDBACCDxxBBAxAxxDxxCBBAADCBDDCCxxBBCCxCAxCBxDDxABABADBxBBADCBCBBCBCxBxCDxCDxAACCxBCBAAADBBDxCCBCDCBCBCxCCxxCBDADCxBBDCxDBCBBBxxBAxxCxCAxDAxBBACDDAABAAxBxDxACBDBCBxAxBAxxABAxxBDACABBDCCCBBCBAAxABCBCDCACAxxDCDDBxBCCxxBDDDxAxBABxDBBxAxBBxCAxxxxBACBxxACABBxCxBBBCxDDCCDDBCBBBCDxAADDADCCBxxBxAACACCDBDxxBDADDDxCCBAADxACCBBACCBxDDDBCDxDADCBDxDACBBDCBxCADBDDCxADDAAxCCBDAxBCAADDBADDDCDDxDDBDxxBxDCxBBADDABxDCCBABCAABBCxBDxCBDADCCxCxDBBCDxCxxDCACxxDBDADBxxAxBABADDCCDCBCxBADBBDCCCBBCACBDxCxACADDxBBxCADCBADADBBBBBDDBCCCDxADxCDDACDCBCACDDxCAADxDCCAxxBDDCxACADCBADCADCDxDABCBBAxDDACDAxCCDDxCxBBDCxAxxxABxDADCAAADxCCAxCACCxCDDDBBBADADDBDDAxDBACBDBDBDxBxxCBCAxBBCAADxDAABxBBBxDDBBDDDDACDBCBDDAxAAxACxxxxxDxADxBAACBxCBAxxBDAxACBBBDDDBACBxxDBBBBCDBADxDDDADAxxBBDxDxxACxCBBCAxxDABBBCDDCABAABCBBxCxCxBDCxADBDDxDxAAxDxBCBCCACxABACDBCCAxDDDCBxAxDCBDxCDCxAACxAACBAACCABBxBAxAADCDxCxBBAxBCDxBCxBABCxBABxBDACDABxBCxCCDDAxBDCxBABABCDDxCCCDDxBBCADDACDxDCCBAxxACBBCCBxCxADCCCBCBxxABxDCADAxDBCDxBCxCDCCCCCADBBCDxABxDACDxDxDBACCCxDCCCxCBADCAxBxBACBDCBDCAxxBADCDBCBBDBxxDDADBxACDxxCxBxACCAxCBADBAABCCxBABxxDBxABADDBCDBCBDBAxxBABDABBDxBCCDBBBxACAxBDxCBAAxDxBxBCADDBBBDACBCDDxCAAxDDBDBDxBDBBABDBCDDBCDBxBxCAAxxBCABADBDAACxxACCCBBABBxxCDACDDADAAAxACDxBCDCAxxDxxDBBBCBDCxADDAxCxCABBDCxBBBDBACxBBxABADAxDxCCBBDDCAxABCCDCBAxxxxCCDxxAAAxBACBDDDCxBAxDxxAxxxABxABCBCBAACBCDADDADDxBDDBxADxxxACxCACxxxADBBCABBBACBxDACCCDBxxCDCDADCAABxCxAACBACBxDBABxCADDCDCADAxxDDBACDBABCxCCDBBCDxDxDxCCDCxBCCDDACDDDDDBxxCDCxCCADxCAABACDABBADABDDABAADDxxxCBDBDBAxAAADBxDxAxxBCCCBxCBxDCBBBDDxDCxCAAxDBACCDCDCxDDCxCBBDDCCBCDCBBCAABDxDxCBDDCDxABxDBAxCACxAAxCDDDCDCCCDBCADDBACxDAxCxDDDABxxxABDCBxDAADACDBxBDAxDBBxAxBBBBDxBBCCxxBCCBCCAxAxDCBAxADxxDDDABCBAxDxDADACxCCBCBCBABxBCBDCCCDDCDACDxADDxBDxCDABCxABCBDCBDACBxDAxBBxxxCBABACDDDCxxxBBDxxxxBABxBCxBBABDxxBAAAAxxDxDCCDxxBDBDDxDBCDBCCABACxCCACABxBDCDDBCBDADBABAxBAACxCABBBBxBBBxCACBAxAxBBBCBCxCCCxBCACCBxAxAxxDAxBxBxBACABCABDABABxBDAAxDDACAxDABCCCBAxACxBxABCABDAAxxCCADCAABCBBxxADBABACBxxxDDxBCAABBCxCDxABxAxAxDDCDBDDBxDADBDADDDBxBADAAxCBDADACxABBDBDCAxBAxDCBxDCBBDCADDDxDACBBCBxBCBBxAADDCCACxAAABBxDxCxDAAxBAxBxACCCBDBCDCDxDADDDABxCBCCACBDACBCxxDAxBCxAxBBDDDDDBAxDxCCxxxBxDxCCBAABBDCCDBBCCCDCCxABCCBCBAADDxACADDxDDBDCCBxxxDBDBCCxxxxCxxBBxxxAAxABAxCDxACBAABAxBDxDCBCABBCDCBADCCBACxCBCDBAxDBBxxDxBACDCAAAADBAxxxABxxCCBDBDDBCxxCADAAxxxDBDCABBADDxCBBDACCxxABBBDDCxCCAxBCAADACCDCDABABAABCAAxDxxxCDDCBBDCDABxDBBADBDxACBBAxBBBAxxxBABAxCxAADBBABDxCABxDxxBAADxAxDxCBBDDBxDCCDxADBxCDBCBDBDBCCxACxCDABACCxDAxxCxDBBDBxCCDCCADDxABBBxADDCDACxxBxBBACBxBBCDAxCABABxxACCCCDxDxxxADACBCCDxBBDACxDABBBBDBAADxABxDBBACADDxAACDBDCCxAABBxCAADDDCxDDBxACBADxBCxxCCAACCBAACxACCxDxCCBxABxDxACxBxDCBDDxCBACDDCCBBDDxxCCAxAxxxBAADABDBBCBABAxxBxDDCBxAxxBAxDDDBCAAxDxCBADDxABCDAAABBACACACCDxxAAABCBCBxCCBxDBxCABCCxADDDACBCBCAxAADAxDCBDACxDxxBxDCCBBBBDCDBxxDAxCCACCDAxxDxAADBxxCDAxABDxDBCCACBCxAACBDxBAxBBAxxBCCDABBxCxxxxxDDDDDACCxAxBABABxBBACBADACCBCCCADBBxDCAAABACCCBBCBDADCxADBAxBCBBBCDDDxBCBxDBCxDxAAxCABAxxAxBCCACBxCxxADxxCxDDDCCBDCAxDBAxxCBxDCAxBABDxxCCCACBDADBxCACCDxxDBACAAACDDCxxxDBDxxBCCBDADCDBDDDDBACDAAAAACBBCCCACACCCBDxBCCBCDDBABACDBCCBxACxDAxBBBACxCCDAxCBAxACCBxCBDCAACBxBxBBxxAxCxABxCCDxABBCDDDDACADBCCDBDBBxDAACABCxBDxBCABBBCBxACBACDBDCxxDDABDABBAACDCDDDCDCBDCBCAxDBDBCDxCAxxDDCxDAAxAxADCBACBDDABDCAxDxADACBCAxDxCxCxCDDBCxCCxCBxDCABBCBDBxBDBCDxBCBxBDABCxBCxDDAxCBAxDDABxAABCxDACDBABAxxBBCCCBxxDADCCBxDAxxxCCCBADABDxDDDxBDDBAADCDCCACDAADBxCDCBCAxBDBCCBBxxCCDAxBDBCxDDCxAADDDDxCDCAxBCBBCxDCCBAAAxDxABDADxDxDADCxDBBAxxDDBDBDCACADCxBDAAxxCAxCCxBxBxDxxDCCAADCAABxCCBDAACCxxCBxDBxBxACDACxxxxDABDDBDAABAxADCBBxxBCDBCxCAxCCBADxxCDxBDxCADxCBAxBCAxDBAxCxCADDDAxADADxDDCDAADAADDACxBBBBDADCBABCCDADAABAxxDxDDCACxCxBBABCxxCBBBDABACAxDADCxBxBDBDxBAxCABCBxDBDDBAACACACADDxDxCBAxCBBABACBAxxBCBDCDCCxACCDBCDCxCDxxDBBADCCDDDDBACxAAABDAADxCxxxDDDCBACDBACxADCxDCDBxBABCCBAAADxAACCDCCCxBBCDxACxxxCDBDDBCACCxBCDADxDCxBxBxBBBACCDABxCBBxCDxAxBBBCDADxDCAxCDBCDxAxDBxCDAxDDDBxCCBBBABDCADxCBACCxDxBACACABADBxBDxADCACxBCDBCCBDDxCxxDBBACBCAACBCxAACxBCBCxAxxCBxCCAADBADxACABADDxCCAxDBACACDxDCxCCCAxDDAABDxCBDBBxDAxCDCBAxBCCCBBxBCDBCCBxABCCCxxxAxBBDDAxDDBAxDxxCAAABxxBDxCDxxxCABAxAADCBBBBCCDDDBBBBDCDCCBACAAACBACxCCxDxBxCBCCDCBAxCABDxBxDBAxDBDxABCCBAxCCDABxACAxAxACCCDDCBBxxxxDCBACDAABBAABBACCBCCBDCxxxDDBACCBxCDxCDDCxCCxABDxBAxCAxxxDDCAAADxxABBBCxDBBAAABCCDBCDxABCxCCDCxCBCADCCxACCCBCxDADBxAxAABxAAABBBABCxxCxCBABBxADxCCCACDADAxxBxACxCBDABAAADAACxDxxxCAACCDxxAACxBCDACBxADBxCCBDxCxBxAAxxxBxxxBxCBCACCAxBBBBAxBABDACABACCACDDCCAABCCABBCCCDBxBxCDxCDDCBDCxACxxAxBAABAACCABBxCBCABCBDxAxxCDDABBCxCxACxCxACBBBCCCCAxxxxCDxCCAAABAAACxADxAAxCBAAxxCxxDBCAxCAAAxCBCAACxxCDBDDxADxCBAACDABAxDABBDCBBAADACDCBBAACAAAABCBCAADBxAxBxBCCxBxDBBxBCCxBDDCCDBDxDCDBDAAxDBAACCADBCBDCDACAxxDDAxxCCCxxABCCxxAxBxCDCxCBCADBxCBADBDCBCAxBACDDDBBDCxDDBBAACxADAAAxxDBCBxDADDBCxACCxxDBABDDCDBAxAxxBxADCBxDAACxABxBCxxxCBAACBBDCABBCCDxBxxDxACDBxxxBCAABxxBxACCxxCxDDxxAADADCDxABBxDDBxACCxCDCACCDCxxCBDDBBxDBxxCCABxABADBADDCBADxAABDADxCCCAACCCABCDCCDAxxBxxDAxBBxCABDxCCDDAACAxxBACxDxDCDBAxxCADBCADADCDDDAAADBBxADxDxACxCCDABxxDCABAxACDAABxDDCxABxCCxDBBxBDBDDACDAxxABxAADCxAxCCDCDACCABBAxCDABDADAxCxCDADCDBDDAABBCADACCABCDDBCABABCADxxAAAAxBABCxCxxDxABDBxxACCAxxBBDxxDDADDxxAADCDBCCCxCBDCxBDDDBxDBBxDxBxDDxADxABCACCDDxBxBBBDCCBDACDDxBDDCxBCBDBACxBxxDDCxBCCAADAxAxCDBDABCCCCCxCxxDCAxADxBCADDADBCABACDBxADxBDDCCADACACBBxCxDBAxxDCDDCDBCABxCxxBDAxxBBABCCBxCADACBAAABBDxDxDBxCCCBDBBCxCxACxCDACAxBDxCABCBDAxDDACDxCCxBxDBBxxBCBCBBDBDCDCBCCxADABCAxCxDBABBACCDDxBBCDxCADxBBDBxCDBxADxACxBDBxBDCDAAAAACDCCx"

		spew.Dump(solve(in))

	})

}
